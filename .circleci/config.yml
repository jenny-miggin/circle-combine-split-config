version: 2.1

setup: true

orbs:
  config-splitting: circle-makotom-orbs/config-splitting@0.0.1

jobs:
  shared-job:
    docker:
      - image: cimg/base:stable
    steps:
      - run: echo "A job from the main config!"
  merge-main-config:
    executor: default
    steps:
    - when:
        condition:
          equal: [ main, << pipeline.git.branch >> ]
        steps:
          - config-splitting/run-all-modular-configs:
              config-list-file: .circleci/modular-config-list-main.txt


workflows:
  setup-config-files:
    jobs:
      # Specify the file listing configs to be combined in `config-list-file`
      # This job combines those listed configs, then execute the resulting config.
      - shared-job
      - merge-main-config:
          requires:
            - shared-job
      # - config-splitting/run-all-modular-configs:
      #     config-list-file: .circleci/modular-config-list-feature.txt
      #     filters:
      #       branches:
      #         ignore: 
      #           - main
      #         only:
      #           - /feature-.*/