# Config splitting

This repository demonstrates the basic usage of the orb `circle-makotom-orbs/config-splitting`.

## Quick hands-on

1.  Fork this repository.
2.  Go to https://app.circleci.com/settings/project/github/YOUR_GITHUB_ORG_NAME/circle-combine-split-config/advanced and enable the option "Enable dynamic config using setup workflows".
3.  Go to https://app.circleci.com/settings/project/github/YOUR_GITHUB_ORG_NAME/circle-combine-split-config and hit the "Follow Project" button there.
    This action will trigger the first pipeline for your forked project.

## Behind the scene

This demonstrates how to create a single config file out of multiple config files, depending on branch

- There are 2 "modular" configs: 
`subdir-a/.circleci/config.yml` and `subdir-b/.circleci/config.yml`
- There are also a series of config files located in the root of `.circleci`
- For the `main` branch, the "modular" configs to be combined are listed in `.circleci/modular-config-list-main.txt`.
- For any `feature` branch, the "modular" configs to be combined are listed in `.circleci/modular-config-list-feature.txt`.
- `.circleci/config.yml` defines the `setup` workflow. The `setup` workflow calls `run-all-modular-configs` job of the config-splitting orb, and combines the configs listed in `.circleci/modular-config-list-*.txt` files (which are specified in `config-list-file` parameter).
- The combined config generated by the `setup` workflow is passed back to CircleCI and then is executed accordingly.
